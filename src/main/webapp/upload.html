<!DOCTYPE html>
<html>
	<head>
		<title>Mediashare - upload</title>
		<meta charset='utf-8'>
		<link rel="stylesheet" href="styles/bootstrap.min.css">
		<link rel="stylesheet" href="styles/bootstrap-theme.min.css">
		<link rel="stylesheet" href="styles/pages.css">
	
		<!-- jQuery -->
		<script src="js/jquery-1.11.2.min.js"></script>
		<script src="js/jquery-migrate-1.2.1.min.js"></script>
		<script type="text/javascript">
			function fileSelected() {
				var file = document.getElementById('fileToUpload').files[0];
				if(file){
					var fileSize = 0;
					if (file.size>1024*1024){
						fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'Méga';
					}else if(file.size>1024){
						fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'Kilo';
					}else{ 
						fileSize = (Math.round(file.size * 100) / 100 ).toString();
					}
					fileSize += 'Octets';
					document.getElementById('fileName').innerHTML = 'Nom : ' + file.name;
					document.getElementById('fileSize').innerHTML = 'Taille : ' + fileSize;
					document.getElementById('fileType').innerHTML = 'Type : ' + file.type;
				}
			}

			function uploadFile() {
				var fd = new FormData();
				fd.append("fileToUpload", document.getElementById('fileToUpload').files[0]);
				var xhr = new XMLHttpRequest();
				xhr.upload.addEventListener("progress", uploadProgress, false);
				xhr.addEventListener("load", uploadComplete, false);
				xhr.addEventListener("error", uploadFailed, false);
				xhr.addEventListener("abort", uploadCanceled, false);
				xhr.open("POST", "upload");
				xhr.send(fd);
			}

			function uploadProgress(evt) {
				if(evt.lengthComputable){
					var percentComplete = Math.round(evt.loaded * 100 / evt.total);
					document.getElementById('progressNumber').innerHTML = percentComplete.toString() + '/100%';
				}else{
					document.getElementById('progressNumber').innerHTML = 'unable to compute';
				}
			}

			function uploadComplete(evt) {
				/* appelé lors de la réponse du serveur */
				alert("fuuuuuuuuuuuuuu\n"+evt.target.responseText);
			}

			function uploadFailed(evt) {
				alert("There was an error attempting to upload the file.");
			}

			function uploadCanceled(evt) {
				alert("The upload has been canceled by the user or the browser dropped the connection.");
			}
		</script>
	</head>
	<body>
		<div class="collapse navbar-collapse" id="navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li><a href="murGeneral.html"> <img src="banniere.png" alt="Banniere du site" style="width:200px;height:94px"> </a></li>
				<li class="active"><p class="navbar-text"><a href="murGeneral.html">Mur General</a></p></li>
				<li class="active"><p class="navbar-text"><a href="recherche.html">Recherche</a></p></li>
				<li class="active"><p class="navbar-text"><a href="profileViewer.html">Profil</a></p></li>
				<li class="active"><p class="navbar-text"><a href="logout.html">Deconnexion</a></p></li>
			</ul>
		</div>
		<center>
			<h1><b>Mediashare</b></h1>
			<form method="POST" action="upload" enctype="multipart/form-data" >
				<div class="row">
					<label for="fileToUpload">Choisissez un fichier à uploader</label><br />
					<input type="file" name="fileToUpload" id="fileToUpload" onchange="fileSelected();"/>
					<input type="text" name="description" id="description" />
				</div>
				<div id="fileName"></div>
				<div id="fileSize"></div>
				<div id="fileType"></div>
				<div class="row">
				<input type="submit" value="upload" name="upload" id="upload" />
				</div>
				<div id="progressNumber"></div>
			</form>
		</center>
	</body>
</html>
